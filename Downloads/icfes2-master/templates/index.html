<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador ICFES Pro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 2.5em;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .config-panel {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 0.95em;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    button {
      padding: 15px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 1.2em;
    }

    .pregunta-card {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 20px;
      border-left: 5px solid #667eea;
    }

    .pregunta-numero {
      color: #667eea;
      font-weight: 700;
      font-size: 0.9em;
      margin-bottom: 10px;
    }

    .pregunta-texto {
      color: #333;
      font-size: 1.15em;
      line-height: 1.6;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .opciones {
      display: grid;
      gap: 12px;
    }

    .opcion-btn {
      width: 100%;
      padding: 15px 20px;
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      text-align: left;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
      color: #333;
    }

    .opcion-btn:hover:not(.correcta):not(.incorrecta) {
      border-color: #667eea;
      background: #f0f4ff;
      transform: translateX(5px);
    }

    .opcion-btn.correcta {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
      font-weight: 600;
    }

    .opcion-btn.incorrecta {
      background: #f8d7da;
      border-color: #dc3545;
      color: #721c24;
    }

    .feedback {
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      font-size: 1em;
      line-height: 1.6;
    }

    .feedback.correcto {
      background: #d4edda;
      border: 2px solid #28a745;
      color: #155724;
    }

    .feedback.incorrecto {
      background: #f8d7da;
      border: 2px solid #dc3545;
      color: #721c24;
    }

    .explicacion {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      border-left: 4px solid #2196f3;
    }

    .explicacion strong {
      color: #1976d2;
    }

    .progreso {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
    }

    .progreso-bar {
      background: #e0e0e0;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progreso-fill {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      transition: width 0.5s ease;
    }

    .resultado-final {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      margin-top: 20px;
    }

    .resultado-final h2 {
      font-size: 2em;
      margin-bottom: 20px;
    }

    .estadisticas {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 20px;
    }

    .stat-item {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 10px;
    }

    .stat-numero {
      font-size: 2.5em;
      font-weight: 700;
    }

    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pregunta-card {
      animation: fadeIn 0.5s ease;
    }

    @media (max-width: 768px) {
      .container { padding: 20px; }
      h1 { font-size: 1.8em; }
      .button-group { grid-template-columns: 1fr; }
      .estadisticas { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéì Simulador ICFES Pro</h1>
    <p class="subtitle">Practica con preguntas generadas por IA</p>

    <div class="config-panel">
      <div class="input-group">
        <label for="tema">üìö Tema de las preguntas:</label>
        <input type="text" id="tema" placeholder="Ej: biolog√≠a, matem√°ticas, lectura cr√≠tica..." value="razonamiento l√≥gico">
      </div>

      <div class="input-group">
        <label for="cantidad">üî¢ N√∫mero de preguntas:</label>
        <select id="cantidad">
          <option value="1">1 pregunta</option>
          <option value="3">3 preguntas</option>
          <option value="5" selected>5 preguntas</option>
          <option value="7">7 preguntas</option>
          <option value="10">10 preguntas</option>
        </select>
      </div>

      <div class="input-group">
        <label for="dificultad">‚ö° Nivel de dificultad:</label>
        <select id="dificultad">
          <option value="facil">F√°cil</option>
          <option value="medio" selected>Medio</option>
          <option value="dificil">Dif√≠cil</option>
        </select>
      </div>

      <div class="button-group">
        <button id="btnGenerar">üöÄ Generar Simulacro</button>
        <button id="btnReset" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">üîÑ Reiniciar</button>
      </div>
    </div>

    <div id="progreso" style="display: none;"></div>
    <div id="resultado"></div>
  </div>

  <script>
    let preguntas = [];
    let preguntaActual = 0;
    let respuestas = [];
    let correctas = 0;

    const btnGenerar = document.getElementById('btnGenerar');
    const btnReset = document.getElementById('btnReset');
    const resultado = document.getElementById('resultado');
    const progreso = document.getElementById('progreso');

    btnGenerar.addEventListener('click', generarSimulacro);
    btnReset.addEventListener('click', reiniciar);

    async function generarSimulacro() {
      const tema = document.getElementById('tema').value.trim() || 'razonamiento l√≥gico';
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const dificultad = document.getElementById('dificultad').value;

      btnGenerar.disabled = true;
      resultado.innerHTML = '<div class="loading">‚è≥ Generando preguntas con IA...</div>';
      progreso.style.display = 'none';

      try {
        const res = await fetch('http://localhost:5000/api/preguntas-multiples', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tema, cantidad, dificultad })
        });

        const data = await res.json();

        if (data.error) {
          resultado.innerHTML = `<div class="feedback incorrecto">‚ö†Ô∏è Error: ${data.error}</div>`;
          btnGenerar.disabled = false;
          return;
        }

        preguntas = data.preguntas;
        preguntaActual = 0;
        respuestas = [];
        correctas = 0;

        mostrarPregunta();
        btnGenerar.disabled = false;

      } catch (error) {
        resultado.innerHTML = `<div class="feedback incorrecto">‚ùå Error de conexi√≥n: ${error.message}</div>`;
        btnGenerar.disabled = false;
      }
    }

    function mostrarPregunta() {
      if (preguntaActual >= preguntas.length) {
        mostrarResultados();
        return;
      }

      const pregunta = preguntas[preguntaActual];
      progreso.style.display = 'block';
      
      progreso.innerHTML = `
        <div class="progreso">
          <strong>Pregunta ${preguntaActual + 1} de ${preguntas.length}</strong>
          <div class="progreso-bar">
            <div class="progreso-fill" style="width: ${((preguntaActual + 1) / preguntas.length) * 100}%"></div>
          </div>
          <small>${correctas} correctas de ${preguntaActual} respondidas</small>
        </div>
      `;

      let html = `
        <div class="pregunta-card">
          <div class="pregunta-numero">Pregunta ${pregunta.numero}</div>
          <div class="pregunta-texto">${pregunta.pregunta}</div>
          <div class="opciones">
      `;

      pregunta.opciones.forEach((opcion, index) => {
        const letra = String.fromCharCode(65 + index);
        html += `<button class="opcion-btn" data-letra="${letra}">${opcion}</button>`;
      });

      html += `</div></div>`;
      resultado.innerHTML = html;

      document.querySelectorAll('.opcion-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const seleccionada = e.target.getAttribute('data-letra');
          verificarRespuesta(seleccionada);
        });
      });
    }

    function verificarRespuesta(seleccionada) {
      const pregunta = preguntas[preguntaActual];
      const correcta = pregunta.respuesta_correcta;
      const esCorrecta = seleccionada === correcta;

      if (esCorrecta) correctas++;

      respuestas.push({
        pregunta: pregunta.pregunta,
        seleccionada: seleccionada,
        correcta: correcta,
        esCorrecta: esCorrecta
      });

      let html = `
        <div class="pregunta-card">
          <div class="pregunta-numero">Pregunta ${pregunta.numero}</div>
          <div class="pregunta-texto">${pregunta.pregunta}</div>
          <div class="opciones">
      `;

      pregunta.opciones.forEach((opcion, index) => {
        const letra = String.fromCharCode(65 + index);
        let clase = '';
        if (letra === correcta) clase = 'correcta';
        else if (letra === seleccionada) clase = 'incorrecta';
        html += `<button class="opcion-btn ${clase}" disabled>${opcion}</button>`;
      });

      html += '</div>';

      if (esCorrecta) {
        html += `<div class="feedback correcto">‚úÖ ¬°Correcto! Has seleccionado la respuesta ${correcta}.</div>`;
      } else {
        html += `
          <div class="feedback incorrecto">
            ‚ùå Incorrecto. Seleccionaste ${seleccionada}, pero la respuesta correcta es ${correcta}.
          </div>
          <div class="explicacion">
            <strong>üí° Explicaci√≥n:</strong> ${pregunta.explicacion}
          </div>
        `;
      }

      html += `<button onclick="siguientePregunta()" style="margin-top: 20px; width: 100%;">‚û°Ô∏è Siguiente Pregunta</button>`;
      html += '</div>';

      resultado.innerHTML = html;
    }

    function siguientePregunta() {
      preguntaActual++;
      mostrarPregunta();
    }

    function mostrarResultados() {
      const porcentaje = Math.round((correctas / preguntas.length) * 100);
      let mensaje = '';
      let emoji = '';

      if (porcentaje >= 90) {
        mensaje = '¬°Excelente! Dominas el tema';
        emoji = 'üèÜ';
      } else if (porcentaje >= 70) {
        mensaje = '¬°Muy bien! Buen desempe√±o';
        emoji = 'üéâ';
      } else if (porcentaje >= 50) {
        mensaje = 'Bien, pero puedes mejorar';
        emoji = 'üìö';
      } else {
        mensaje = 'Necesitas practicar m√°s';
        emoji = 'üí™';
      }

      resultado.innerHTML = `
        <div class="resultado-final">
          <div style="font-size: 5em; margin-bottom: 20px;">${emoji}</div>
          <h2>${mensaje}</h2>
          <div class="estadisticas">
            <div class="stat-item">
              <div class="stat-numero">${correctas}</div>
              <div class="stat-label">Correctas</div>
            </div>
            <div class="stat-item">
              <div class="stat-numero">${preguntas.length - correctas}</div>
              <div class="stat-label">Incorrectas</div>
            </div>
            <div class="stat-item">
              <div class="stat-numero">${porcentaje}%</div>
              <div class="stat-label">Porcentaje</div>
            </div>
          </div>
          <button onclick="reiniciar()" style="margin-top: 30px; background: white; color: #667eea; width: 100%;">
            üîÑ Hacer Otro Simulacro
          </button>
        </div>
      `;

      progreso.style.display = 'none';
    }

    function reiniciar() {
      preguntas = [];
      preguntaActual = 0;
      respuestas = [];
      correctas = 0;
      resultado.innerHTML = '';
      progreso.style.display = 'none';
      document.getElementById('tema').value = 'razonamiento l√≥gico';
      document.getElementById('cantidad').value = '5';
      document.getElementById('dificultad').value = 'medio';
    }
  </script>
</body>
</html>